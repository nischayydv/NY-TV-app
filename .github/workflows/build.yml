name: Build NY TV Android App

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup JDK 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    - name: Create Project Structure
      run: |
        # Create directory structure
        mkdir -p app/src/main/java/com/nytv/live/data/model
        mkdir -p app/src/main/java/com/nytv/live/data/network
        mkdir -p app/src/main/java/com/nytv/live/data/repository
        mkdir -p app/src/main/java/com/nytv/live/ui/activity
        mkdir -p app/src/main/java/com/nytv/live/ui/adapter
        mkdir -p app/src/main/java/com/nytv/live/ui/viewmodel
        mkdir -p app/src/main/res/layout
        mkdir -p app/src/main/res/values
        mkdir -p app/src/main/res/drawable
        mkdir -p app/src/main/res/anim
        mkdir -p app/src/main/res/mipmap-anydpi-v26
        mkdir -p app/src/main/res/mipmap-hdpi
        mkdir -p app/src/main/res/mipmap-mdpi
        mkdir -p app/src/main/res/mipmap-xhdpi
        mkdir -p app/src/main/res/mipmap-xxhdpi
        mkdir -p app/src/main/res/mipmap-xxxhdpi
        mkdir -p gradle/wrapper

    - name: Setup Gradle Wrapper
      run: |
        # Create gradle-wrapper.properties
        cat > gradle/wrapper/gradle-wrapper.properties << 'EOF'
        distributionBase=GRADLE_USER_HOME
        distributionPath=wrapper/dists
        distributionUrl=https\://services.gradle.org/distributions/gradle-8.7-bin.zip
        zipStoreBase=GRADLE_USER_HOME
        zipStorePath=wrapper/dists
        EOF
        
        # Download gradle-wrapper.jar
        curl -L -o gradle/wrapper/gradle-wrapper.jar https://raw.githubusercontent.com/gradle/gradle/v8.7.0/gradle/wrapper/gradle-wrapper.jar
        
        # Create gradlew script
        cat > gradlew << 'EOF'
        #!/bin/sh
        
        DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'
        APP_NAME="Gradle"
        APP_BASE_NAME=${0##*/}
        APP_HOME=$( cd "${0%/*}" && pwd )
        
        exec "$APP_HOME/gradle/wrapper/gradle-wrapper.jar" org.gradle.wrapper.GradleWrapperMain "$@"
        EOF
        
        chmod +x gradlew

    - name: Create Root Build Files
      run: |
        # settings.gradle
        cat > settings.gradle << 'EOF'
        pluginManagement {
            repositories {
                google()
                mavenCentral()
                gradlePluginPortal()
            }
        }
        dependencyResolutionManagement {
            repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
            repositories {
                google()
                mavenCentral()
            }
        }
        rootProject.name = "NY TV"
        include ':app'
        EOF
        
        # gradle.properties
        cat > gradle.properties << 'EOF'
        org.gradle.jvmargs=-Xmx2048m -Dfile.encoding=UTF-8
        android.useAndroidX=true
        android.enableJetifier=true
        kotlin.code.style=official
        android.nonTransitiveRClass=false
        EOF
        
        # build.gradle (Project)
        cat > build.gradle << 'EOF'
        buildscript {
            ext.kotlin_version = '1.9.20'
            repositories {
                google()
                mavenCentral()
            }
            dependencies {
                classpath 'com.android.tools.build:gradle:8.2.0'
                classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
            }
        }

        allprojects {
            repositories {
                google()
                mavenCentral()
            }
        }

        task clean(type: Delete) {
            delete rootProject.buildDir
        }
        EOF

    - name: Create App Build File
      run: |
        cat > app/build.gradle << 'EOF'
        plugins {
            id 'com.android.application'
            id 'kotlin-android'
            id 'kotlin-parcelize'
        }

        android {
            namespace 'com.nytv.live'
            compileSdk 34

            defaultConfig {
                applicationId "com.nytv.live"
                minSdk 21
                targetSdk 34
                versionCode 1
                versionName "1.0.0"
                vectorDrawables.useSupportLibrary = true
            }

            buildTypes {
                release {
                    minifyEnabled false
                    proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
                }
            }
            
            compileOptions {
                sourceCompatibility JavaVersion.VERSION_17
                targetCompatibility JavaVersion.VERSION_17
            }
            
            kotlinOptions {
                jvmTarget = '17'
            }
            
            buildFeatures {
                viewBinding true
            }
        }

        dependencies {
            implementation 'androidx.core:core-ktx:1.12.0'
            implementation 'androidx.appcompat:appcompat:1.6.1'
            implementation 'com.google.android.material:material:1.11.0'
            implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
            implementation 'androidx.recyclerview:recyclerview:1.3.2'
            implementation 'androidx.lifecycle:lifecycle-runtime-ktx:2.7.0'
            implementation 'androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0'
            implementation 'androidx.lifecycle:lifecycle-livedata-ktx:2.7.0'
            implementation 'androidx.cardview:cardview:1.0.0'
            implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3'
            implementation 'androidx.media3:media3-exoplayer:1.2.1'
            implementation 'androidx.media3:media3-exoplayer-dash:1.2.1'
            implementation 'androidx.media3:media3-exoplayer-hls:1.2.1'
            implementation 'androidx.media3:media3-ui:1.2.1'
            implementation 'com.squareup.retrofit2:retrofit:2.9.0'
            implementation 'com.squareup.retrofit2:converter-gson:2.9.0'
            implementation 'com.squareup.okhttp3:okhttp:4.12.0'
            implementation 'com.squareup.okhttp3:logging-interceptor:4.12.0'
            implementation 'com.github.bumptech.glide:glide:4.16.0'
            implementation 'com.google.code.gson:gson:2.10.1'
        }
        EOF
        
        # proguard-rules.pro
        cat > app/proguard-rules.pro << 'EOF'
        -keep class com.nytv.live.data.model.** { *; }
        -keepclassmembers class * {
            @com.google.gson.annotations.SerializedName <fields>;
        }
        -keep class androidx.media3.** { *; }
        -dontwarn androidx.media3.**
        EOF

    - name: Create AndroidManifest
      run: |
        cat > app/src/main/AndroidManifest.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <manifest xmlns:android="http://schemas.android.com/apk/res/android">
            <uses-permission android:name="android.permission.INTERNET" />
            <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
            <uses-permission android:name="android.permission.WAKE_LOCK" />

            <application
                android:name=".NYTVApplication"
                android:allowBackup="true"
                android:icon="@mipmap/ic_launcher"
                android:label="@string/app_name"
                android:theme="@style/Theme.NYTV"
                android:usesCleartextTraffic="true"
                android:hardwareAccelerated="true">
                
                <activity
                    android:name=".ui.activity.SplashActivity"
                    android:exported="true"
                    android:theme="@style/Theme.NYTV.Splash">
                    <intent-filter>
                        <action android:name="android.intent.action.MAIN" />
                        <category android:name="android.intent.category.LAUNCHER" />
                    </intent-filter>
                </activity>
                
                <activity
                    android:name=".ui.activity.MainActivity"
                    android:exported="false"
                    android:configChanges="orientation|screenSize" />
                
                <activity
                    android:name=".ui.activity.PlayerActivity"
                    android:exported="false"
                    android:configChanges="orientation|screenSize|keyboardHidden"
                    android:theme="@style/Theme.NYTV.Fullscreen" />
            </application>
        </manifest>
        EOF

    - name: Create Kotlin Source Files
      run: |
        # NYTVApplication.kt
        cat > app/src/main/java/com/nytv/live/NYTVApplication.kt << 'EOF'
        package com.nytv.live

        import android.app.Application

        class NYTVApplication : Application() {
            override fun onCreate() {
                super.onCreate()
            }
        }
        EOF
        
        # Channel.kt
        cat > app/src/main/java/com/nytv/live/data/model/Channel.kt << 'EOF'
        package com.nytv.live.data.model

        import android.os.Parcelable
        import com.google.gson.annotations.SerializedName
        import kotlinx.parcelize.Parcelize

        @Parcelize
        data class Channel(
            @SerializedName("name") val name: String,
            @SerializedName("logo") val logo: String? = null,
            @SerializedName("link") val link: String,
            @SerializedName("cookie") val cookie: String? = null,
            @SerializedName("drmLicense") val drmLicense: String? = null
        ) : Parcelable
        EOF
        
        # ApiService.kt
        cat > app/src/main/java/com/nytv/live/data/network/ApiService.kt << 'EOF'
        package com.nytv.live.data.network

        import com.nytv.live.data.model.Channel
        import okhttp3.OkHttpClient
        import okhttp3.logging.HttpLoggingInterceptor
        import retrofit2.Response
        import retrofit2.Retrofit
        import retrofit2.converter.gson.GsonConverterFactory
        import retrofit2.http.GET
        import java.util.concurrent.TimeUnit

        interface ApiService {
            @GET("Ziotv.json")
            suspend fun getChannels(): Response<List<Channel>>
        }

        object ApiClient {
            private const val BASE_URL = "https://playify.pages.dev/"
            
            val apiService: ApiService by lazy {
                Retrofit.Builder()
                    .baseUrl(BASE_URL)
                    .addConverterFactory(GsonConverterFactory.create())
                    .client(
                        OkHttpClient.Builder()
                            .addInterceptor(HttpLoggingInterceptor().apply {
                                level = HttpLoggingInterceptor.Level.BASIC
                            })
                            .connectTimeout(30, TimeUnit.SECONDS)
                            .readTimeout(30, TimeUnit.SECONDS)
                            .build()
                    )
                    .build()
                    .create(ApiService::class.java)
            }
        }
        EOF
        
        # ChannelRepository.kt
        cat > app/src/main/java/com/nytv/live/data/repository/ChannelRepository.kt << 'EOF'
        package com.nytv.live.data.repository

        import com.nytv.live.data.model.Channel
        import com.nytv.live.data.network.ApiClient
        import kotlinx.coroutines.Dispatchers
        import kotlinx.coroutines.withContext

        class ChannelRepository {
            suspend fun getChannels(): Result<List<Channel>> = withContext(Dispatchers.IO) {
                try {
                    val response = ApiClient.apiService.getChannels()
                    if (response.isSuccessful) {
                        response.body()?.let { Result.success(it) } 
                            ?: Result.failure(Exception("Empty response"))
                    } else {
                        Result.failure(Exception("HTTP ${response.code()}"))
                    }
                } catch (e: Exception) {
                    Result.failure(e)
                }
            }
        }
        EOF
        
        # MainViewModel.kt
        cat > app/src/main/java/com/nytv/live/ui/viewmodel/MainViewModel.kt << 'EOF'
        package com.nytv.live.ui.viewmodel

        import androidx.lifecycle.LiveData
        import androidx.lifecycle.MutableLiveData
        import androidx.lifecycle.ViewModel
        import androidx.lifecycle.viewModelScope
        import com.nytv.live.data.model.Channel
        import com.nytv.live.data.repository.ChannelRepository
        import kotlinx.coroutines.launch

        class MainViewModel : ViewModel() {
            private val repository = ChannelRepository()
            private val _channels = MutableLiveData<List<Channel>>()
            val channels: LiveData<List<Channel>> = _channels
            private val _filteredChannels = MutableLiveData<List<Channel>>()
            val filteredChannels: LiveData<List<Channel>> = _filteredChannels
            private val _isLoading = MutableLiveData<Boolean>()
            val isLoading: LiveData<Boolean> = _isLoading
            private val _error = MutableLiveData<String?>()
            val error: LiveData<String?> = _error
            private var allChannels: List<Channel> = emptyList()
            
            init { loadChannels() }
            
            fun loadChannels() {
                viewModelScope.launch {
                    _isLoading.value = true
                    _error.value = null
                    repository.getChannels()
                        .onSuccess { channelList ->
                            allChannels = channelList
                            _channels.value = channelList
                            _filteredChannels.value = channelList
                        }
                        .onFailure { exception ->
                            _error.value = exception.message ?: "Failed to load channels"
                        }
                    _isLoading.value = false
                }
            }
            
            fun searchChannels(query: String) {
                _filteredChannels.value = if (query.isBlank()) allChannels 
                    else allChannels.filter { it.name.contains(query, ignoreCase = true) }
            }
        }
        EOF

    - name: Create Activity Files
      run: |
        # SplashActivity.kt
        cat > app/src/main/java/com/nytv/live/ui/activity/SplashActivity.kt << 'EOF'
        package com.nytv.live.ui.activity

        import android.content.Intent
        import android.os.Bundle
        import android.os.Handler
        import android.os.Looper
        import androidx.appcompat.app.AppCompatActivity
        import com.nytv.live.R

        class SplashActivity : AppCompatActivity() {
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContentView(R.layout.activity_splash)
                
                Handler(Looper.getMainLooper()).postDelayed({
                    startActivity(Intent(this, MainActivity::class.java))
                    finish()
                }, 2000)
            }
        }
        EOF
        
        # MainActivity.kt
        cat > app/src/main/java/com/nytv/live/ui/activity/MainActivity.kt << 'EOF'
        package com.nytv.live.ui.activity

        import android.content.Intent
        import android.os.Bundle
        import android.text.Editable
        import android.text.TextWatcher
        import android.view.View
        import android.widget.EditText
        import android.widget.ProgressBar
        import android.widget.TextView
        import androidx.appcompat.app.AppCompatActivity
        import androidx.lifecycle.ViewModelProvider
        import androidx.recyclerview.widget.GridLayoutManager
        import androidx.recyclerview.widget.RecyclerView
        import com.nytv.live.R
        import com.nytv.live.data.model.Channel
        import com.nytv.live.ui.adapter.ChannelAdapter
        import com.nytv.live.ui.viewmodel.MainViewModel

        class MainActivity : AppCompatActivity() {
            private lateinit var viewModel: MainViewModel
            private lateinit var adapter: ChannelAdapter
            
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContentView(R.layout.activity_main)
                
                viewModel = ViewModelProvider(this)[MainViewModel::class.java]
                
                val recyclerView = findViewById<RecyclerView>(R.id.recyclerView)
                val searchInput = findViewById<EditText>(R.id.searchInput)
                val loading = findViewById<ProgressBar>(R.id.loading)
                val errorText = findViewById<TextView>(R.id.errorText)
                val resultsCount = findViewById<TextView>(R.id.resultsCount)
                
                adapter = ChannelAdapter { channel -> 
                    val intent = Intent(this, PlayerActivity::class.java)
                    intent.putExtra("CHANNEL", channel)
                    startActivity(intent)
                }
                recyclerView.layoutManager = GridLayoutManager(this, 2)
                recyclerView.adapter = adapter
                
                searchInput.addTextChangedListener(object : TextWatcher {
                    override fun afterTextChanged(s: Editable?) {
                        viewModel.searchChannels(s?.toString() ?: "")
                    }
                    override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {}
                    override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {}
                })
                
                viewModel.filteredChannels.observe(this) { channels ->
                    adapter.updateChannels(channels)
                    resultsCount.text = "${channels.size} channels"
                }
                
                viewModel.isLoading.observe(this) { isLoading ->
                    loading.visibility = if (isLoading) View.VISIBLE else View.GONE
                }
                
                viewModel.error.observe(this) { error ->
                    errorText.text = error ?: ""
                    errorText.visibility = if (error != null) View.VISIBLE else View.GONE
                }
            }
        }
        EOF
        
        # PlayerActivity.kt
        cat > app/src/main/java/com/nytv/live/ui/activity/PlayerActivity.kt << 'EOF'
        package com.nytv.live.ui.activity

        import android.os.Bundle
        import android.widget.TextView
        import androidx.appcompat.app.AppCompatActivity
        import androidx.media3.common.MediaItem
        import androidx.media3.common.util.UnstableApi
        import androidx.media3.exoplayer.ExoPlayer
        import androidx.media3.ui.PlayerView
        import com.nytv.live.R
        import com.nytv.live.data.model.Channel

        @UnstableApi
        class PlayerActivity : AppCompatActivity() {
            private var player: ExoPlayer? = null
            
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContentView(R.layout.activity_player)
                
                val channel = intent.getParcelableExtra<Channel>("CHANNEL")
                val playerView = findViewById<PlayerView>(R.id.playerView)
                val channelTitle = findViewById<TextView>(R.id.channelTitle)
                
                channel?.let {
                    channelTitle.text = it.name
                    player = ExoPlayer.Builder(this).build()
                    playerView.player = player
                    
                    val mediaItem = MediaItem.fromUri(it.link)
                    player?.setMediaItem(mediaItem)
                    player?.prepare()
                    player?.play()
                }
                
                findViewById<View>(R.id.backButton).setOnClickListener { finish() }
            }
            
            override fun onDestroy() {
                super.onDestroy()
                player?.release()
            }
        }
        EOF
        
        # ChannelAdapter.kt
        cat > app/src/main/java/com/nytv/live/ui/adapter/ChannelAdapter.kt << 'EOF'
        package com.nytv.live.ui.adapter

        import android.view.LayoutInflater
        import android.view.View
        import android.view.ViewGroup
        import android.widget.ImageView
        import android.widget.TextView
        import androidx.recyclerview.widget.RecyclerView
        import com.bumptech.glide.Glide
        import com.nytv.live.R
        import com.nytv.live.data.model.Channel

        class ChannelAdapter(
            private val onChannelClick: (Channel) -> Unit
        ) : RecyclerView.Adapter<ChannelAdapter.ChannelViewHolder>() {
            
            private var channels = listOf<Channel>()
            
            fun updateChannels(newChannels: List<Channel>) {
                channels = newChannels
                notifyDataSetChanged()
            }
            
            override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ChannelViewHolder {
                val view = LayoutInflater.from(parent.context)
                    .inflate(R.layout.item_channel, parent, false)
                return ChannelViewHolder(view)
            }
            
            override fun onBindViewHolder(holder: ChannelViewHolder, position: Int) {
                holder.bind(channels[position])
            }
            
            override fun getItemCount() = channels.size
            
            inner class ChannelViewHolder(view: View) : RecyclerView.ViewHolder(view) {
                private val logo: ImageView = view.findViewById(R.id.channelLogo)
                private val name: TextView = view.findViewById(R.id.channelName)
                
                fun bind(channel: Channel) {
                    name.text = channel.name
                    Glide.with(itemView.context)
                        .load(channel.logo)
                        .placeholder(R.drawable.ic_tv_placeholder)
                        .into(logo)
                    
                    itemView.setOnClickListener { onChannelClick(channel) }
                }
            }
        }
        EOF

    - name: Create Layout Files
      run: |
        # activity_main.xml
        cat > app/src/main/res/layout/activity_main.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:orientation="vertical"
            android:background="#2c3e50">
            
            <EditText
                android:id="@+id/searchInput"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:padding="16dp"
                android:hint="Search channels..."
                android:layout_margin="16dp" />
            
            <TextView
                android:id="@+id/resultsCount"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:paddingStart="16dp"
                android:paddingEnd="16dp"
                android:textColor="#FFFFFF" />
            
            <FrameLayout
                android:layout_width="match_parent"
                android:layout_height="match_parent">
                
                <androidx.recyclerview.widget.RecyclerView
                    android:id="@+id/recyclerView"
                    android:layout_width="match_parent"
                    android:layout_height="match_parent"
                    android:padding="8dp" />
                
                <ProgressBar
                    android:id="@+id/loading"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center"
                    android:visibility="gone" />
                
                <TextView
                    android:id="@+id/errorText"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center"
                    android:textColor="#FFFFFF"
                    android:visibility="gone" />
            </FrameLayout>
        </LinearLayout>
        EOF
        
        # activity_player.xml
        cat > app/src/main/res/layout/activity_player.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:background="#000000">
            
            <androidx.media3.ui.PlayerView
                android:id="@+id/playerView"
                android:layout_width="match_parent"
                android:layout_height="match_parent" />
            
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:padding="16dp">
                
                <ImageView
                    android:id="@+id/backButton"
                    android:layout_width="48dp"
                    android:layout_height="48dp"
                    android:src="@drawable/ic_back"
                    android:background="?attr/selectableItemBackground" />
                
                <TextView
                    android:id="@+id/channelTitle"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:layout_gravity="center_vertical"
                    android:paddingStart="16dp"
                    android:paddingEnd="16dp"
                    android:textSize="18sp"
                    android:textColor="#FFFFFF" />
            </LinearLayout>
        </FrameLayout>
        EOF
        
        # item_channel.xml
        cat > app/src/main/res/layout/item_channel.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"
            xmlns:app="http://schemas.android.com/apk/res-auto"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_margin="8dp"
            app:cardCornerRadius="8dp">
            
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp"
                android:gravity="center">
                
                <ImageView
                    android:id="@+id/channelLogo"
                    android:layout_width="80dp"
                    android:layout_height="80dp"
                    android:scaleType="centerCrop" />
                
                <TextView
                    android:id="@+id/channelName"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="8dp"
                    android:textSize="14sp"
                    android:textStyle="bold"
                    android:maxLines="2"
                    android:ellipsize="end" />
            </LinearLayout>
        </androidx.cardview.widget.CardView>
        EOF
        
        # activity_splash.xml
        cat > app/src/main/res/layout/activity_splash.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
            android:layout_width="match_parent"
            android:layout_height="match_parent"
            android:orientation="vertical"
            android:gravity="center"
            android:background="#1a1a2e">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="NY TV"
                android:textSize="48sp"
                android:textStyle="bold"
                android:textColor="#DAA520" />
            
            <ProgressBar
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="32dp" />
        </LinearLayout>
        EOF

    - name: Create Drawable Resources
      run: |
        # ic_tv_placeholder.xml
        cat > app/src/main/res/drawable/ic_tv_placeholder.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <vector xmlns:android="http://schemas.android.com/apk/res/android"
            android:width="24dp"
            android:height="24dp"
            android:viewportWidth="24"
            android:viewportHeight="24">
            <path
                android:fillColor="#DAA520"
                android:pathData="M21,3H3C1.9,3 1,3.9 1,5v14c0,1.1 0.9,2 2,2h18c1.1,0 2,-0.9 2,-2V5C23,3.9 22.1,3 21,3zM21,19H3V5h18V19zM16,11l-7,4V7L16,11z"/>
        </vector>
        EOF
        
        # ic_back.xml
        cat > app/src/main/res/drawable/ic_back.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <vector xmlns:android="http://schemas.android.com/apk/res/android"
            android:width="24dp"
            android:height="24dp"
            android:viewportWidth="24"
            android:viewportHeight="24">
            <path
                android:fillColor="#FFFFFF"
                android:pathData="M20,11H7.83l5.59,-5.59L12,4l-8,8 8,8 1.41,-1.41L7.83,13H20v-2z"/>
        </vector>
        EOF
        
        # ic_launcher_foreground.xml
        cat > app/src/main/res/drawable/ic_launcher_foreground.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <vector xmlns:android="http://schemas.android.com/apk/res/android"
            android:width="108dp"
            android:height="108dp"
            android:viewportWidth="108"
            android:viewportHeight="108">
            <path
                android:fillColor="#DAA520"
                android:pathData="M54,24L54,84L84,54Z"/>
        </vector>
        EOF

    - name: Create Mipmap Resources
      run: |
        # ic_launcher.xml
        cat > app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">
            <background android:drawable="@color/dark_background"/>
            <foreground android:drawable="@drawable/ic_launcher_foreground"/>
        </adaptive-icon>
        EOF
        
        # Create placeholder PNGs
        touch app/src/main/res/mipmap-mdpi/ic_launcher.png
        touch app/src/main/res/mipmap-hdpi/ic_launcher.png
        touch app/src/main/res/mipmap-xhdpi/ic_launcher.png
        touch app/src/main/res/mipmap-xxhdpi/ic_launcher.png
        touch app/src/main/res/mipmap-xxxhdpi/ic_launcher.png

    - name: Create Values Resources
      run: |
        # strings.xml
        cat > app/src/main/res/values/strings.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <string name="app_name">NY TV</string>
        </resources>
        EOF
        
        # colors.xml
        cat > app/src/main/res/values/colors.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <color name="royal_gold">#DAA520</color>
            <color name="black">#000000</color>
            <color name="white">#FFFFFF</color>
            <color name="dark_background">#1a1a2e</color>
        </resources>
        EOF
        
        # themes.xml
        cat > app/src/main/res/values/themes.xml << 'EOF'
        <?xml version="1.0" encoding="utf-8"?>
        <resources>
            <style name="Theme.NYTV" parent="Theme.MaterialComponents.DayNight.NoActionBar">
                <item name="colorPrimary">@color/royal_gold</item>
                <item name="colorAccent">@color/royal_gold</item>
                <item name="android:statusBarColor">@color/royal_gold</item>
            </style>
            
            <style name="Theme.NYTV.Splash" parent="Theme.NYTV">
                <item name="android:windowFullscreen">true</item>
            </style>
            
            <style name="Theme.NYTV.Fullscreen" parent="Theme.NYTV">
                <item name="android:windowFullscreen">true</item>
                <item name="android:windowBackground">@color/black</item>
            </style>
        </resources>
        EOF

    - name: Validate Gradle Setup
      run: |
        echo "Validating Gradle wrapper..."
        ls -la gradle/wrapper/
        ls -la gradlew
        
    - name: Build Debug APK
      run: |
        ./gradlew clean
        ./gradlew assembleDebug --stacktrace --info
      
    - name: Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: NY-TV-App-Debug
        path: app/build/outputs/apk/debug/app-debug.apk
        retention-days: 30
        
    - name: Create GitHub Release
      if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master')
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: NY TV Release v1.0.${{ github.run_number }}
        body: |
          ## NY TV Android App
          
          **Build:** ${{ github.run_number }}
          **Commit:** ${{ github.sha }}
          
          ### Features
          - Live TV streaming
          - Channel search
          - Modern Material Design UI
          - ExoPlayer integration
          
          ### Installation
          Download and install the APK file below.
          
        draft: false
        prerelease: false
        files: app/build/outputs/apk/debug/app-debug.apk
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
